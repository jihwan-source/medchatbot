# scenarios/indigestion.yaml
# 소화불량 / 위-식도 역류질환 문진 시나리오

name: "소화불량 문진"
initial_question_id: GREETING

nodes:
  - id: GREETING
    text: |
      안녕하세요! OOO 의원 AI 문진 챗봇입니다.
      '속이 불편한 증상'에 대해 몇 가지 질문을 드릴게요.
      현재 가장 불편하신 증상은 아래 중 어떤 것에 가장 가깝나요?
    type: buttons
    options:
      - text: "A. 타는 듯한 속쓰림이나 신물이 올라오는 느낌"
        next_id: RED_FLAG_CHECK # 모든 경로는 Red Flag 체크를 먼저 거침
        set_context: { path: "GERD" } # 사용자의 경로를 컨텍스트에 저장
      - text: "B. 명치(윗배) 부근의 통증이나 쓰린 느낌"
        next_id: RED_FLAG_CHECK
        set_context: { path: "ULCER" }
      - text: "C. 음식을 먹으면 금방 배가 부르거나, 식후 더부룩함"
        next_id: RED_FLAG_CHECK
        set_context: { path: "DYSMOTILITY" }

  - id: RED_FLAG_CHECK
    text: |
      ※ 안전한 진료를 위해 가장 중요한 질문입니다.
      아래 증상 중 하나라도 해당되는 것이 있다면 즉시 알려주세요.
      1. 가슴을 쥐어짜는 듯한 통증이 팔이나 턱으로 뻗친다.
      2. 피를 토하거나, 커피가루 같은 것을 토했다.
      3. 짜장면 색깔의 검은 변을 보았다.
      4. 음식을 삼키기 어렵거나, 삼킬 때 통증이 있다.
      5. 최근 6개월간 의도치 않은 체중 감소(5kg 이상)가 있다.
    type: buttons
    options:
      - text: "네, 해당하는 증상이 있어요"
        next_id: END_EMERGENCY_WARNING
      - text: "아니요, 모두 괜찮아요"
        next_id: PATH_ROUTER # 경로 분기점으로 이동

  - id: PATH_ROUTER
    type: condition_router # 컨텍스트에 저장된 경로에 따라 분기
    check_context: "path"
    routes:
      - value: "GERD"
        next_id: GERD_PATH_1
      - value: "ULCER"
        next_id: ULCER_PATH_1
      - value: "DYSMOTILITY"
        next_id: DYSMOTILITY_PATH_1

  # --- GERD (A) 경로 ---
  - id: GERD_PATH_1
    text: "속쓰림이나 신물은 주로 언제 심해지나요? (모두 선택 가능)"
    type: multiple_choice
    options:
      - text: "식사 직후"
      - text: "누워있을 때나 밤에"
      - text: "공복에"
      - text: "항상 비슷해요"
    next_id: GERD_PATH_2

  - id: GERD_PATH_2
    text: "혹시 기름진 음식, 커피, 술, 초콜릿 등을 먹었을 때 증상이 더 심해지는 것 같나요?"
    type: buttons
    options:
      - text: "네, 그런 것 같아요"
        next_id: GERD_PATH_3
      - text: "아니요, 음식과 상관없어요"
        next_id: GERD_PATH_3

  - id: GERD_PATH_3
    text: "속쓰림 외에 아래와 같은 증상이 동반되나요? (모두 선택 가능)"
    type: multiple_choice
    options:
      - text: "목에 뭔가 걸린 듯한 이물감"
      - text: "이유 없는 만성 기침"
      - text: "목소리가 자주 쉬어요"
      - text: "해당 없음"
    next_id: COMMON_ONSET # 공통 질문으로 합류

  # --- Ulcer (B) 경로 ---
  - id: ULCER_PATH_1
    text: "명치가 아픈 느낌은 어떤가요?"
    type: buttons
    options:
      - text: "타는 듯한 느낌"
        next_id: ULCER_PATH_2
      - text: "칼로 베는 듯한 느낌"
        next_id: ULCER_PATH_2
      - text: "쥐어짜는 듯한 느낌"
        next_id: ULCER_PATH_2
      - text: "기타"
        next_id: ULCER_PATH_2

  - id: ULCER_PATH_2
    text: "식사를 하는 것이 통증에 어떤 영향을 주나요?"
    type: buttons
    options:
      - text: "음식을 먹으면 통증이 더 심해져요"
        next_id: ULCER_PATH_3
      - text: "음식을 먹으면 오히려 통증이 줄어들어요"
        next_id: ULCER_PATH_3
      - text: "식사와 별로 상관없어요"
        next_id: ULCER_PATH_3

  - id: ULCER_PATH_3
    text: "혹시 속이 쓰려서 잠에서 깨신 적이 있나요?"
    type: buttons
    options:
      - text: "네, 있어요"
        next_id: COMMON_ONSET # 공통 질문으로 합류
      - text: "아니요, 없어요"
        next_id: COMMON_ONSET # 공통 질문으로 합류

  # --- Dysmotility (C) 경로 ---
  - id: DYSMOTILITY_PATH_1
    text: "식사를 시작하고 얼마나 지나서 배가 부르다고 느끼시나요?"
    type: buttons
    options:
      - text: "몇 숟갈만 먹어도 배가 불러요 (조기 포만감)"
        next_id: DYSMOTILITY_PATH_2
      - text: "식사를 다 마친 후에 더부룩함이 오래가요 (식후 포만감)"
        next_id: DYSMOTILITY_PATH_2
        
  - id: DYSMOTILITY_PATH_2
    text: "더부룩함 외에 아래 증상이 동반되나요? (모두 선택 가능)"
    type: multiple_choice
    options:
      - text: "메스꺼움 (구역질)"
      - text: "잦은 트림"
      - text: "윗배가 빵빵하게 부푸는 느낌"
      - text: "해당 없음"
    next_id: COMMON_ONSET # 공통 질문으로 합류

  # --- 공통 질문 (모든 경로가 합류) ---
  - id: COMMON_ONSET
    text: "이런 증상들이 처음 시작된 지는 얼마나 되었나요?"
    type: buttons
    options:
      - text: "1개월 미만"
        next_id: COMMON_MEDS
      - text: "1~6개월 사이"
        next_id: COMMON_MEDS
      - text: "6개월 이상"
        next_id: COMMON_MEDS

  - id: COMMON_MEDS
    text: "최근 소염진통제(NSAIDs), 아스피린, 스테로이드 같은 약을 복용한 적이 있나요?"
    type: buttons
    options:
      - text: "네, 있어요"
        next_id: COMMON_PMH
      - text: "아니요, 없어요"
        next_id: COMMON_PMH

  - id: COMMON_PMH
    text: "이전에 위/십이지장 궤양, 위염, 역류성 식도염, 혹은 헬리코박터균 감염을 진단받은 적이 있나요?"
    type: buttons
    options:
      - text: "네, 있어요"
        next_id: COMMON_SOCIAL
      - text: "아니요, 없어요"
        next_id: COMMON_SOCIAL

  - id: COMMON_SOCIAL
    text: "흡연이나 음주를 하시나요? 하신다면 얼마나 자주 하시나요?"
    type: free_text
    next_id: COMMON_STRESS

  - id: COMMON_STRESS
    text: "최근 스트레스를 많이 받았거나, 식습관에 큰 변화가 있었나요?"
    type: buttons
    options:
      - text: "네, 있어요"
        next_id: CLOSING
      - text: "아니요, 없어요"
        next_id: CLOSING

  # --- 마무리 단계 ---
  - id: CLOSING
    text: |
      꼼꼼하게 답변해주셔서 감사합니다. 질문이 모두 끝났습니다.
      답변 내용은 의사 선생님이 한눈에 파악하실 수 있도록 정리하여 전달하겠습니다.
    type: final

  - id: END_EMERGENCY_WARNING
    text: "즉각적인 의학적 확인이 필요할 수 있습니다. 문진을 중단하고 바로 의료진의 도움을 받으세요."
    type: final
