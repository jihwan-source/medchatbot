# scenarios/uri.yaml
# 상기도 감염(감기) 문진 시나리오

# 챗봇의 이름과 시작 질문 ID
name: "상기도 감염 문진"
initial_question_id: GREETING

# 각 질문 단계(node)들의 목록
nodes:
  - id: GREETING
    text: |
      안녕하세요! OOO 의원 AI 문진 챗봇입니다.
      의사 선생님과의 진료가 더 정확하고 효율적으로 이루어지도록, 내원하시게 된 이유에 대해 몇 가지 질문을 드릴게요.
      현재 가장 불편한 증상이 '감기 기운'이 맞으실까요?
    type: buttons
    options:
      - text: "네, 맞아요"
        next_id: HPI_ONSET
      - text: "아니요, 다른 증상이에요"
        next_id: END_OTHER_SYMPTOM

  - id: HPI_ONSET
    text: "증상이 언제 처음 시작되었나요?"
    type: buttons
    options:
      - text: "오늘"
        next_id: HPI_FEVER
      - text: "어제"
        next_id: HPI_FEVER
      - text: "2~3일 전"
        next_id: HPI_FEVER
      - text: "4일 이상"
        next_id: HPI_FEVER
  
  - id: HPI_FEVER
    text: "현재 열이 나나요? 38°C 이상 고열이 있었거나, 지금 있다면 알려주세요."
    type: buttons
    options:
      - text: "네, 고열이 있어요"
        next_id: HPI_COUGH_SPUTUM
      - text: "미열만 있어요"
        next_id: HPI_COUGH_SPUTUM
      - text: "열은 없어요"
        next_id: HPI_COUGH_SPUTUM

  - id: HPI_COUGH_SPUTUM
    text: "기침이나 가래 증상이 있나요? (해당하는 것 모두 선택)"
    type: buttons # 여러 개 선택 가능한 버튼
    options:
      - text: "기침이 나요"
      - text: "가래가 있어요"
      - text: "둘 다 없어요"
    next_id: HPI_SPUTUM_COLOR_CONDITION # 다음 단계는 조건부로 결정

  - id: HPI_SPUTUM_COLOR_CONDITION
    type: condition # 조건 분기 노드
    # 사용자가 HPI_COUGH_SPUTUM 단계에서 '가래가 있어요'를 선택했는지 확인
    check_answer:
      node_id: HPI_COUGH_SPUTUM
      contains: "가래가 있어요"
    next_id_if_true: HPI_SPUTUM_COLOR # 조건이 참이면 가래색 질문
    next_id_if_false: HPI_SORE_THROAT # 조건이 거짓이면 인후통 질문으로 건너뛰기

  - id: HPI_SPUTUM_COLOR
    text: "가래는 어떤 색인가요?"
    type: buttons
    options:
      - text: "맑은 색 또는 흰색"
        next_id: HPI_SORE_THROAT
      - text: "노란색 또는 녹색"
        next_id: HPI_SORE_THROAT

  - id: HPI_SORE_THROAT
    text: "목이 아픈 증상(인후통)이 있나요?"
    type: buttons
    options:
      - text: "네, 목이 아파요"
        next_id: HPI_SORE_THROAT_DETAIL
      - text: "아니요, 괜찮아요"
        next_id: HPI_NASAL

  - id: HPI_SORE_THROAT_DETAIL
    text: "침이나 음식을 삼킬 때 통증이 심한 편인가요?"
    type: buttons
    options:
      - text: "네, 많이 아파요"
        next_id: HPI_NASAL
      - text: "조금 불편한 정도예요"
        next_id: HPI_NASAL
  
  - id: HPI_NASAL
    text: "콧물이나 코막힘 증상이 있나요? (해당하는 것 모두 선택)"
    type: buttons
    options:
      - text: "콧물이 나요"
      - text: "코가 막혀요"
      - text: "둘 다 없어요"
    next_id: RED_FLAG

  - id: RED_FLAG
    text: |
      ※ 안전한 진료를 위해 가장 중요한 질문입니다.
      아래 증상 중 하나라도 해당되는 것이 있다면 꼭 알려주세요.
      1. 38°C 이상의 고열이 3일 이상 지속된다.
      2. 숨이 차거나 숨쉬기 어렵다.
      3. 가만히 있어도 가슴에 통증이 있다.
      4. 어지럽거나 정신이 혼미한 느낌이 든다.
    type: buttons
    options:
      - text: "네, 해당하는 증상이 있어요"
        next_id: PMH
      - text: "아니요, 모두 괜찮아요"
        next_id: PMH
  
  - id: PMH
    text: |
      현재 꾸준히 복용 중인 약이나 앓고 있는 질환(천식, 당뇨, 고혈압 등)이 있나요? 혹시 약물이나 음식 알레르기가 있다면 함께 알려주세요.
      (예: 천식이 있고, 아스피린 알레르기가 있어요)
    type: free_text # 사용자가 직접 텍스트를 입력
    next_id: CLOSING

  - id: CLOSING
    text: |
      감사합니다. 질문이 모두 끝났습니다.
      답변해주신 내용은 의사 선생님께 잘 전달하여, 잠시 후 진료실에서 더 자세한 상담이 이루어질 수 있도록 돕겠습니다.
    type: final # 대화 종료 노드

  - id: END_OTHER_SYMPTOM
    text: "알겠습니다. 이 챗봇은 감기 증상 관련 문진을 돕고 있습니다. 다른 증상은 의사 선생님께 직접 말씀해주세요."
    type: final

